<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Singles | Firelight Duel Academy - Yu-Gi-Oh! Single Cards</title>
    <meta name="description" content="Browse our extensive collection of Yu-Gi-Oh! single cards. Find meta cards, staples, and rare collectibles with competitive prices.">
    <link rel="stylesheet" href="../assets/css/main.css">
    <link rel="stylesheet" href="../assets/css/components/advanced-layout.css">
    <link rel="stylesheet" href="../assets/css/pages/yugioh-store.css">
    <link rel="icon" href="https://images.ygoprodeck.com/images/cards/89631139.jpg">
</head>
<body>
    <div class="page-wrapper">
        <!-- Top Header Bar -->
        <header class="top-header">
            <div class="header-container">
                <div class="site-branding">
                    <img src="https://images.ygoprodeck.com/images/cards/89631139.jpg" alt="Firelight Duel Academy" class="site-logo">
                    <h1 class="site-name">Firelight Duel Academy</h1>
                    <p class="site-tagline">Yu-Gi-Oh! Trading Cards & Competitive Play</p>
                </div>
                <div class="header-actions">
                    <div class="search-container">
                        <input type="text" id="card-search" placeholder="Search Yu-Gi-Oh! cards..." class="search-input">
                        <button class="search-btn" onclick="performSearch()">üîç</button>
                    </div>
                    <div class="user-actions">
                        <button class="account-btn" onclick="showLogin()">üë§ Account</button>
                        <button class="cart-btn" onclick="openCart()">
                            üõí Cart <span class="cart-count">0</span>
                        </button>
                    </div>
                </div>
            </div>
        </header>

        <!-- Navigation Tabs -->
        <nav class="main-navigation">
            <div class="nav-container">
                <ul class="nav-tabs">
                    <li><a href="../index.html" class="nav-link">Home</a></li>
                    <li><a href="singles.html" class="nav-link active">Singles</a></li>
                    <li><a href="decks.html" class="nav-link">Popular Decks</a></li>
                    <li><a href="events.html" class="nav-link">Events</a></li>
                    <li><a href="account.html" class="nav-link">My Account</a></li>
                </ul>
            </div>
        </nav>

        <!-- Main Content Area -->
        <main class="content-area">
            <div class="page-header">
                <h1>Yu-Gi-Oh! Single Cards</h1>
                <p>Browse our extensive collection of single cards from all sets and rarities</p>
            </div>

            <!-- Filters Section -->
            <section class="filters-section">
                <div class="filter-bar">
                    <div class="filter-group">
                        <label for="card-name">Card Name:</label>
                        <input type="text" id="card-name" placeholder="Search by card name...">
                    </div>
                    <div class="filter-group">
                        <label for="card-type">Type:</label>
                        <select id="card-type">
                            <option value="">All Types</option>
                            <option value="monster">Monster</option>
                            <option value="spell">Spell</option>
                            <option value="trap">Trap</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label for="rarity">Rarity:</label>
                        <select id="rarity">
                            <option value="">All Rarities</option>
                            <option value="common">Common</option>
                            <option value="rare">Rare</option>
                            <option value="super">Super Rare</option>
                            <option value="ultra">Ultra Rare</option>
                            <option value="secret">Secret Rare</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label for="price-range">Price Range:</label>
                        <select id="price-range">
                            <option value="">All Prices</option>
                            <option value="0-5">$0 - $5</option>
                            <option value="5-15">$5 - $15</option>
                            <option value="15-50">$15 - $50</option>
                            <option value="50+">$50+</option>
                        </select>
                    </div>
                    <button class="filter-btn" onclick="applyFilters()">Apply Filters</button>
                </div>
            </section>

            <!-- Featured Categories -->
            <section class="featured-categories">
                <h2>Popular Categories</h2>
                <div class="category-grid">
                    <div class="category-item">
                        <img src="https://images.ygoprodeck.com/images/cards/76375976.jpg" alt="Snake-Eye">
                        <h3>Snake-Eye</h3>
                        <p>Latest meta archetype</p>
                    </div>
                    <div class="category-item">
                        <img src="https://images.ygoprodeck.com/images/cards/28776350.jpg" alt="Kashtira">
                        <h3>Kashtira</h3>
                        <p>Powerful banish strategy</p>
                    </div>
                    <div class="category-item">
                        <img src="https://images.ygoprodeck.com/images/cards/14558127.jpg" alt="Hand Traps">
                        <h3>Hand Traps</h3>
                        <p>Essential staples</p>
                    </div>
                    <div class="category-item">
                        <img src="https://images.ygoprodeck.com/images/cards/89631139.jpg" alt="Classic Cards">
                        <h3>Classic Cards</h3>
                        <p>Nostalgic favorites</p>
                    </div>
                </div>
            </section>

            <!-- Cards Grid -->
            <section class="cards-section">
                <div class="section-header">
                    <h2>All Single Cards</h2>
                    <div class="sort-options">
                        <label for="sort-by">Sort by:</label>
                        <select id="sort-by">
                            <option value="name">Name A-Z</option>
                            <option value="price-low">Price: Low to High</option>
                            <option value="price-high">Price: High to Low</option>
                            <option value="newest">Newest First</option>
                        </select>
                    </div>
                </div>
                
                <div id="cards-grid" class="cards-grid loading">
                    <div class="loading-spinner">Loading cards...</div>
                </div>

                <div class="pagination">
                    <button class="page-btn" disabled>Previous</button>
                    <span class="page-info">Page 1 of 50</span>
                    <button class="page-btn">Next</button>
                </div>
            </section>
        </main>

        <!-- Footer -->
        <footer class="site-footer">
            <div class="footer-content">
                <div class="footer-section">
                    <h3>Firelight Duel Academy</h3>
                    <p>Your premier destination for Yu-Gi-Oh! singles</p>
                </div>
                <div class="footer-section">
                    <h4>Quick Links</h4>
                    <ul>
                        <li><a href="singles.html">Browse Singles</a></li>
                        <li><a href="account.html">My Account</a></li>
                        <li><a href="contact.html">Contact Us</a></li>
                    </ul>
                </div>
            </div>
            <div class="footer-bottom">
                <p>&copy; 2025 Firelight Duel Academy. All rights reserved.</p>
            </div>
        </footer>
    </div>

    <!-- Scripts -->
    <script src="../assets/js/services/ygoprodeck-api.js"></script>
    <script src="../assets/js/components/advanced-functionality.js"></script>
    <script src="../assets/js/pages/yugioh-store.js"></script>
    <script>
        let currentCards = [];
        let filteredCards = [];
        let currentPage = 1;
        const cardsPerPage = 20;

        // Load cards on page load
        document.addEventListener('DOMContentLoaded', async function() {
            await loadCards();
            setupEventListeners();
        });

        async function loadCards() {
            const grid = document.getElementById('cards-grid');
            
            try {
                // Get URL parameters for filtering
                const urlParams = new URLSearchParams(window.location.search);
                const archetype = urlParams.get('archetype');
                const category = urlParams.get('category');
                const filter = urlParams.get('filter');

                let cards = [];
                
                if (archetype) {
                    cards = await window.ygoproAPI.getCardsByArchetype(archetype);
                } else if (category === 'Hand-Traps') {
                    // Get hand trap cards
                    const handTrapNames = ['Ash Blossom & Joyous Spring', 'Effect Veiler', 'Ghost Ogre & Snow Rabbit', 'Nibiru, the Primal Being', 'Droll & Lock Bird'];
                    for (const name of handTrapNames) {
                        try {
                            const card = await window.ygoproAPI.getCardByName(name);
                            if (card) cards.push(card);
                        } catch (e) {
                            console.warn(`Could not fetch ${name}`);
                        }
                    }
                } else {
                    // Get meta cards as default
                    cards = await window.ygoproAPI.getMetaCards();
                    
                    // Add some additional popular cards
                    const additionalCards = await window.ygoproAPI.getCards({ name: 'Blue-Eyes' });
                    cards = [...cards, ...additionalCards.slice(0, 5)];
                }

                if (cards.length === 0) {
                    grid.innerHTML = '<p class="no-cards">No cards found. Try adjusting your search criteria.</p>';
                    return;
                }

                currentCards = cards.map(card => window.ygoproAPI.formatCardForDisplay(card));
                filteredCards = [...currentCards];
                
                displayCards();
                updatePagination();
                
            } catch (error) {
                console.error('Error loading cards:', error);
                grid.innerHTML = '<p class="error">Failed to load cards. Please try again later.</p>';
            }
        }

        function displayCards() {
            const grid = document.getElementById('cards-grid');
            grid.classList.remove('loading');
            
            const startIndex = (currentPage - 1) * cardsPerPage;
            const endIndex = startIndex + cardsPerPage;
            const cardsToShow = filteredCards.slice(startIndex, endIndex);
            
            if (cardsToShow.length === 0) {
                grid.innerHTML = '<p class="no-cards">No cards match your current filters.</p>';
                return;
            }

            grid.innerHTML = '';
            
            cardsToShow.forEach(card => {
                const cardElement = createCardElement(card);
                grid.appendChild(cardElement);
            });
        }

        function createCardElement(card) {
            const cardDiv = document.createElement('div');
            cardDiv.className = 'card-item';
            cardDiv.onclick = () => window.location.href = window.ygoproAPI.getProductPageURL(card);
            
            const isHot = parseFloat(card.price) > 50; // Mark expensive cards as "HOT"
            
            cardDiv.innerHTML = `
                <div class="card-image-container">
                    <img src="${card.imageSmall}" alt="${card.name}" class="card-image" loading="lazy">
                    ${isHot ? '<div class="card-meta-badge">HOT</div>' : ''}
                </div>
                <div class="card-info">
                    <h3 class="card-name">${card.name}</h3>
                    <p class="card-type">${card.type}</p>
                    <p class="card-price">$${card.price}</p>
                    <button class="add-to-cart-btn" onclick="event.stopPropagation(); addToCart('${card.name}', ${card.price})">Add to Cart</button>
                </div>
            `;
            
            return cardDiv;
        }

        function setupEventListeners() {
            // Search functionality
            const cardNameInput = document.getElementById('card-name');
            cardNameInput.addEventListener('input', debounce(applyFilters, 300));
            
            // Filter change listeners
            document.getElementById('card-type').addEventListener('change', applyFilters);
            document.getElementById('rarity').addEventListener('change', applyFilters);
            document.getElementById('price-range').addEventListener('change', applyFilters);
            document.getElementById('sort-by').addEventListener('change', applySorting);
        }

        function applyFilters() {
            const nameFilter = document.getElementById('card-name').value.toLowerCase();
            const typeFilter = document.getElementById('card-type').value.toLowerCase();
            const rarityFilter = document.getElementById('rarity').value.toLowerCase();
            const priceFilter = document.getElementById('price-range').value;
            
            filteredCards = currentCards.filter(card => {
                // Name filter
                if (nameFilter && !card.name.toLowerCase().includes(nameFilter)) {
                    return false;
                }
                
                // Type filter
                if (typeFilter && !card.type.toLowerCase().includes(typeFilter)) {
                    return false;
                }
                
                // Rarity filter (simplified)
                if (rarityFilter && !card.rarity.toLowerCase().includes(rarityFilter)) {
                    return false;
                }
                
                // Price filter
                if (priceFilter) {
                    const price = parseFloat(card.price);
                    const [min, max] = priceFilter.split('-').map(p => p === '+' ? Infinity : parseFloat(p));
                    if (max !== undefined) {
                        if (price < min || price > max) return false;
                    } else {
                        if (price < min) return false;
                    }
                }
                
                return true;
            });
            
            currentPage = 1;
            applySorting();
        }

        function applySorting() {
            const sortBy = document.getElementById('sort-by').value;
            
            filteredCards.sort((a, b) => {
                switch (sortBy) {
                    case 'name':
                        return a.name.localeCompare(b.name);
                    case 'price-low':
                        return parseFloat(a.price) - parseFloat(b.price);
                    case 'price-high':
                        return parseFloat(b.price) - parseFloat(a.price);
                    case 'newest':
                        return b.id - a.id; // Assuming higher ID = newer
                    default:
                        return 0;
                }
            });
            
            displayCards();
            updatePagination();
        }

        function updatePagination() {
            const totalPages = Math.ceil(filteredCards.length / cardsPerPage);
            const pageInfo = document.querySelector('.page-info');
            const prevBtn = document.querySelector('.page-btn:first-child');
            const nextBtn = document.querySelector('.page-btn:last-child');
            
            pageInfo.textContent = `Page ${currentPage} of ${totalPages}`;
            
            prevBtn.disabled = currentPage === 1;
            nextBtn.disabled = currentPage === totalPages;
            
            prevBtn.onclick = () => {
                if (currentPage > 1) {
                    currentPage--;
                    displayCards();
                    updatePagination();
                }
            };
            
            nextBtn.onclick = () => {
                if (currentPage < totalPages) {
                    currentPage++;
                    displayCards();
                    updatePagination();
                }
            };
        }

        function addToCart(cardName, price) {
            console.log(`Adding ${cardName} to cart for $${price}`);
            
            // Update cart count
            const cartCount = document.querySelector('.cart-count');
            const currentCount = parseInt(cartCount.textContent) || 0;
            cartCount.textContent = currentCount + 1;
            
            // Show success message
            alert(`${cardName} added to cart!`);
        }

        function performSearch() {
            const searchInput = document.getElementById('card-search');
            const searchTerm = searchInput.value.trim();
            
            if (searchTerm) {
                document.getElementById('card-name').value = searchTerm;
                applyFilters();
            }
        }

        // Debounce function to limit API calls
        function debounce(func, wait) {
            let timeout;
            return function executedFunction(...args) {
                const later = () => {
                    clearTimeout(timeout);
                    func(...args);
                };
                clearTimeout(timeout);
                timeout = setTimeout(later, wait);
            };
        }
    </script>
</body>
</html>
